diff --git a/CMakeLists.txt b/CMakeLists.txt
index 4c175c1..ed69d8a 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -77,7 +77,17 @@ corrosion_import_crate(MANIFEST_PATH Cargo.toml CRATES chewing_capi)
 if(BUILD_TESTING)
     corrosion_import_crate(MANIFEST_PATH Cargo.toml CRATES chewing_testhelper)
 endif()
+if (EMSCRIPTEN)
+    corrosion_add_target_rustflags(chewing_capi -C panic=unwind)
+    set(CARGO_FEATURES "")
+else()
 corrosion_import_crate(MANIFEST_PATH Cargo.toml CRATES chewing-cli)
+    set(CARGO_FEATURES "--features=threading")
+endif()
+set_target_properties(chewing_capi PROPERTIES
+    CORROSION_ADD_ARGS "${CARGO_FEATURES}"
+)
+corrosion_add_target_rustflags(chewing_capi "--remap-path-prefix=${PROJECT_SOURCE_DIR}=.")
 
 if(WITH_SQLITE3)
     corrosion_set_features(chewing_capi FEATURES sqlite)
@@ -242,7 +252,7 @@ endif()
 install(FILES ${ALL_INC} DESTINATION ${CMAKE_INSTALL_INCLUDEDIR}/chewing)
 install(FILES ${PROJECT_BINARY_DIR}/chewing.pc
     DESTINATION ${CMAKE_INSTALL_LIBDIR}/pkgconfig)
-install(TARGETS libchewing
+install(TARGETS chewing_capi
     EXPORT libchewingTargets
     ARCHIVE DESTINATION ${CMAKE_INSTALL_LIBDIR}
     INCLUDES DESTINATION ${CMAKE_INSTALL_INCLUDEDIR}
@@ -261,7 +271,9 @@ if(BUILD_DATA)
     )
 endif()
 
+if(NOT EMSCRIPTEN)
 install(IMPORTED_RUNTIME_ARTIFACTS chewing-cli DESTINATION ${CMAKE_INSTALL_BINDIR})
+endif()
 
 # generate CMake Config files
 include(CMakePackageConfigHelpers)
diff --git a/Cargo.toml b/Cargo.toml
index fccb102..9022072 100644
--- a/Cargo.toml
+++ b/Cargo.toml
@@ -30,6 +30,7 @@ default = []
 sqlite = ["dep:rusqlite"]
 sqlite-bundled = ["sqlite", "rusqlite/bundled"]
 log = ["tracing/log"]
+threading = []
 
 [workspace]
 members = ["capi", "fuzzer", "tests/testhelper", "tools"]
diff --git a/src/dictionary/trie_buf.rs b/src/dictionary/trie_buf.rs
index 933e0ba..5a844fe 100644
--- a/src/dictionary/trie_buf.rs
+++ b/src/dictionary/trie_buf.rs
@@ -209,6 +209,7 @@ impl TrieBuf {
 
     pub(crate) fn sync(&mut self) -> Result<(), UpdateDictionaryError> {
         info!("Synchronize dictionary from disk...");
+    #[cfg(feature = "threading")] {
         if let Some(join_handle) = self.join_handle.take() {
             if !join_handle.is_finished() {
                 info!("Aborted. Wait until previous sync is finished.");
@@ -238,6 +239,7 @@ impl TrieBuf {
                 self.trie = Some(Trie::open(self.path().unwrap())?);
             }
         }
+    }
         Ok(())
     }
 
@@ -258,6 +260,7 @@ impl TrieBuf {
             join_handle: None,
             dirty: false,
         };
+    #[cfg(feature = "threading")] {
         self.join_handle = Some(thread::spawn(move || {
             let mut builder = TrieBuilder::new();
             info!("Saving snapshot...");
@@ -273,6 +276,30 @@ impl TrieBuf {
             info!("    Done");
             Ok(())
         }));
+    }
+        #[cfg(not(feature = "threading"))] {
+            let mut builder = TrieBuilder::new();
+            info!("Saving snapshot...");
+            let _ = builder.set_info(DictionaryInfo {
+                software: software_version(),
+                ..snapshot.about()
+            });
+            for (syllables, phrase) in snapshot.entries() {
+                builder.insert(&syllables, phrase);
+            }
+            info!("Flushing snapshot...");
+            builder.build(snapshot.path().unwrap());
+            info!("    Done");
+            info!("Reloading...");
+            let trie = Trie::open(self.path().unwrap());
+            if let Ok(value) = trie {
+                self.trie = Some(value)
+            }
+            if !self.dirty {
+                self.btree.clear();
+                self.graveyard.clear();
+            }
+        }
         self.dirty = false;
     }
 }
@@ -357,10 +384,12 @@ impl Drop for TrieBuf {
     fn drop(&mut self) {
         let _ = self.sync();
         let _ = self.flush();
+    #[cfg(feature = "threading")] {
         if let Some(join_handle) = self.join_handle.take() {
             let _ = join_handle.join();
         }
     }
+    }
 }
 
 #[cfg(test)]
